(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/room/room"],{"3e96":function(e,t,o){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=o("2f62");function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(t){i(e,t,o[t])})}return e}function i(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var r=function(){return o.e("components/chatinput").then(o.bind(null,"2ca2"))},u=function(){return o.e("components/messageshow").then(o.bind(null,"1ed2"))},a={data:function(){return{style:{pageHeight:0,contentViewHeight:0,footViewHeight:90,mitemHeight:0},scrollTop:0,messages:[],socketOpen:!1}},components:{chatInput:r,messageShow:u},created:function(){var t=e.getSystemInfoSync();this.style.pageHeight=t.windowHeight,this.style.contentViewHeight=t.windowHeight-e.getSystemInfoSync().screenWidth/750*100,this.getMsgList(),this.getsocketTask()},computed:(0,s.mapState)(["locallPath","userInfo","wsPath"]),methods:{getInputMessage:function(e){this.toRobot(e.content)},addMessage:function(e,t,o){var n=this;n.messages.push({user:e,info:t,userInfo:o})},getMsgList:function(){var t=this,o=this;e.request({url:this.locallPath+"/BBS/getMsgList",method:"POST",success:function(e){console.log(n(e," at pages\\room\\room.vue:52"));var s=e.data;t.messages=s.map(function(e){var t=e.userInfo.openId;return c({},e,{user:t===o.userInfo.openId?"customer":"home"})}),setTimeout(function(){o.scrollToBottom()},30)}})},scrollToBottom:function(){var t=this,o=e.createSelectorQuery();o.selectAll(".m-item").boundingClientRect(),o.select("#scrollview").boundingClientRect(),o.exec(function(e){t.style.mitemHeight=0,e[0].forEach(function(e){t.style.mitemHeight=t.style.mitemHeight+e.height+40}),t.style.mitemHeight>t.style.contentViewHeight&&(t.scrollTop=t.style.mitemHeight-t.style.contentViewHeight,console.log(n(t.scrollTop," at pages\\room\\room.vue:83")))})},toRobot:function(t){var o={userInfo:this.userInfo,info:t};this.socketOpen&&e.sendSocketMessage({data:JSON.stringify(o)})},getsocketTask:function(){var t=this;e.connectSocket({url:this.wsPath+"/BBS/getMsg"}),e.onSocketOpen(function(e){console.log(n(e,"打开了"," at pages\\room\\room.vue:104")),t.socketOpen=!0}),e.onSocketMessage(function(e){console.log(n("收到服务器内容："+e.data," at pages\\room\\room.vue:108"));var o=JSON.parse(e.data),s=o.userInfo.openId;o.user=s===t.userInfo.openId?"customer":"home",t.messages.push(o),setTimeout(function(){t.scrollToBottom()},30)})}}};t.default=a}).call(this,o("6e42")["default"],o("0de9")["default"])},6133:function(e,t,o){"use strict";(function(e){o("91e2"),o("921b");n(o("66fd"));var t=n(o("a3f7"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("6e42")["createPage"])},"675c":function(e,t,o){},a3f7:function(e,t,o){"use strict";o.r(t);var n=o("c615"),s=o("c6f3");for(var c in s)"default"!==c&&function(e){o.d(t,e,function(){return s[e]})}(c);o("ba59");var i=o("2877"),r=Object(i["a"])(s["default"],n["a"],n["b"],!1,null,null,null);t["default"]=r.exports},ba59:function(e,t,o){"use strict";var n=o("675c"),s=o.n(n);s.a},c615:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},s=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return s})},c6f3:function(e,t,o){"use strict";o.r(t);var n=o("3e96"),s=o.n(n);for(var c in n)"default"!==c&&function(e){o.d(t,e,function(){return n[e]})}(c);t["default"]=s.a}},[["6133","common/runtime","common/vendor"]]]);